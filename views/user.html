<!DOCTYPE html>
<html>
<head>
  <meta charset=\"utf-8\">
  <title>ΚΥΛΙΚΕΙΟ ΜΕΡΥΒ</title>
  <style>
    html, body {
      font-family: Arial, sans-serif;
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    header {
      background-color: #90EE90;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    main {
      flex: 1;
      padding: 20px;
      text-align: center;
    }
    footer {
      background-color: #000;
      color: #fff;
      padding: 10px;
      text-align: center;
      font-size: 16px;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    button {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    .cancel-btn { background-color: red; color: white; }
    .obs-btn { background-color: #4CAF50; color: white; }
  </style>
</head>
<body>
<header>
  <h1>ΜΕΡΑΡΧΙΑ ΥΠΟΣΤΗΡΙΞΗΣ ΒΑΣΗΣ</h1>
  <h3>Σελίδα Πωλητή</h3>
</header>

<main>
  <label for=\"quantity\">ΠΟΣΟΤΗΤΑ:</label>
  <input type=\"number\" id=\"quantity\" value=\"1\" min=\"1\" style=\"font-size:18px;padding:5px;width:80px;\">
  <div id=\"products-container\"></div>

  <h2>Τελευταίες 3 πωλήσεις</h2>
  <div id=\"last-sales\"></div>
</main>

<footer>&copy; ΜΕΡΥΒ/ΓΕΠ 2025</footer>

<script>
async function fetchProducts() {
  const res = await fetch(\"/api/products\");
  const data = await res.json();
  const container = document.getElementById(\"products-container\");
  container.innerHTML = \"\";
  data.forEach(product => {
    const btn = document.createElement(\"button\");
    btn.innerText = `${product.name} (Τιμή: ${product.price}€)`;
    btn.onclick = () => sellProduct(product.id);
    container.appendChild(btn);
  });
}

async function sellProduct(productId) {
  const quantity = document.getElementById(\"quantity\").value || 1;
  const res = await fetch(\"/api/sell\", {
    method: \"POST\",
    headers: { \"Content-Type\": \"application/json\" },
    body: JSON.stringify({ productId, quantity })
  });

  const data = await res.json();
  if (res.ok) {
    alert(data.message);
    document.getElementById(\"quantity\").value = 1;
    fetchLastSales();
  } else {
    alert(data.message);
  }
}

async function fetchLastSales() {
  const res = await fetch(\"/api/last-sales\");
  const data = await res.json();
  const div = document.getElementById(\"last-sales\");
  div.innerHTML = \"\";

  data.forEach((sale, idx) => {
    const p = document.createElement(\"p\");
    p.innerHTML = `Προϊόν: ${sale.productName}, Τιμή: ${sale.price}€, Ποσότητα: ${sale.quantity}`;

    const cancelBtn = document.createElement(\"button\");
    cancelBtn.className = \"cancel-btn\";
    cancelBtn.innerText = \"Ακύρωση\";
    cancelBtn.onclick = () => cancelSale(idx);

    const obsInput = document.createElement(\"input\");
    obsInput.placeholder = \"ΠΑΡΑΤΗΡΗΣΕΙΣ\";

    const obsBtn = document.createElement(\"button\");
    obsBtn.innerText = \"✓\";
    obsBtn.onclick = () => sendObservation(idx, obsInput.value);

    p.appendChild(cancelBtn);
    p.appendChild(obsInput);
    p.appendChild(obsInput);

    const obsSendBtn = document.createElement(\"button\");
    obsSendBtn.innerText = \"✓\";
    obsSendBtn.onclick = () => sendObservation(idx, obsInput.value);

    p.appendChild(obsSendBtn);

    div.appendChild(p);
  });
}

async function cancelSale(saleIndex) {
  const res = await fetch(\"/api/cancel\", {
    method: \"POST\",
    headers: { \"Content-Type\": \"application/json\" },
    body: JSON.stringify({ saleIndex })
  });
  const data = await res.json();
  alert(data.message);
  fetchLastSales();
}

async function sendObservation(saleIndex, observation) {
  const res = await fetch(\"/api/observation\", {
    method: \"POST\",
    headers: { \"Content-Type\": \"application/json\" },
    body: JSON.stringify({ saleIndex, observation })
  });
  const data = await res.json();
  alert(data.message);
}

// Αρχική φόρτωση
fetchProducts();
fetchLastSales();
</script>

</body>
</html>
