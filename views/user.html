<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Σελίδα Χρήστη</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background-color: #90EE90; text-align: center; padding: 20px; }
    header h1 { color: #444; }
    main { padding: 20px; text-align: center; }
    button { font-size: 18px; padding: 10px; margin: 5px; cursor: pointer; }
    #quantity { font-size: 18px; padding: 5px; width: 60px; text-align: center; }
    footer { background-color: #000; color: #fff; text-align: center; padding: 10px; position: fixed; bottom: 0; width: 100%; }
    .cancel-btn { background-color: red; color: white; }
  </style>
</head>
<body>

<header>
  <h1>Σελίδα Πωλητή</h1>
</header>

<main>
  <input type="number" id="quantity" value="1" min="1" placeholder="ΠΟΣΟΤΗΤΑ">
  <div id="products-container"></div>
  <div id="message"></div>

  <h2>Τελευταίες 3 πωλήσεις</h2>
  <div id="last-sales"></div>
</main>

<footer>
  &copy; ΜΕΡΥΒ/ΓΕΠ 2025
</footer>

<script>
// Φόρτωση προϊόντων
async function fetchProducts() {
  const res = await fetch("/api/products");
  const data = await res.json();
  const container = document.getElementById("products-container");
  container.innerHTML = "";

  data.forEach(product => {
    const btn = document.createElement("button");
    btn.innerText = `${product.name} (${product.price}€)`;
    btn.onclick = () => {
      const quantity = document.getElementById("quantity").value || 1;
      sellProduct(product.id, quantity.value);
    };
    container.appendChild(btn);
  });
});

async function sellProduct(productId, quantity) {
  const res = await fetch("/api/sell", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productId, quantity })
  });
  const data = await res.json();
  document.getElementById("message").innerText = data.message;
  document.getElementById("quantity").value = 1;
  fetchLastSales();
}

async function fetchLastSales() {
  const res = await fetch("/api/last-sales");
  const data = await res.json();
  const div = document.getElementById("last-sales");
  div.innerHTML = "";

  data.forEach((sale, index) => {
    const p = document.createElement("p");
    p.textContent = `Προϊόν: ${sale.productName}, Τιμή: ${sale.price}€, Ποσότητα: ${sale.quantity}`;

    const cancelBtn = document.createElement("button");
    cancelBtn.innerText = "Ακύρωση";
    cancelBtn.classList.add("cancel-btn");
    cancelBtn.onclick = () => cancelSale(index);
    p.appendChild(cancelBtn);

    const observationInput = document.createElement("input");
    observationInput.placeholder = "ΠΑΡΑΤΗΡΗΣΕΙΣ";
    observationInput.value = sale.observation;
    p.appendChild(observationInput);

    const saveBtn = document.createElement("button");
    saveBtn.innerText = "✓";
    saveBtn.onclick = () => saveObservation(index, observationInput.value);
    p.appendChild(saveBtn);

    div.appendChild(p);
  });
}

async function cancelSale(index) {
  const res = await fetch("/api/cancel", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ saleIndex: index })
  });
  const data = await res.json();
  alert(data.message);
  fetchLastSales();
}

async function saveObservation(index, observation) {
  const res = await fetch("/api/observation", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ saleIndex: index, observation })
  });
  const data = await res.json();
  alert(data.message);
}

fetchProducts();
fetchLastSales();
</script>
</body>
</html>
