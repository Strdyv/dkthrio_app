<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Σελίδα Χρήστη</title>
  <style>
    body { font-family: Arial, sans-serif; }
    header {
      background-color: #90EE90;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    button {
      padding: 10px;
      margin: 5px;
      cursor: pointer;
    }
    footer {
      background-color: #000;
      color: #fff;
      text-align: center;
      padding: 10px;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    .cancel-btn { background-color: red; color: #fff; }
    .obs-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .obs-btn { background-color: green; color: white; }
  </style>
</head>
<body>

<header>
  <h1>ΜΕΡΑΡΧΙΑ ΥΠΟΣΤΗΡΙΞΗΣ ΒΑΣΗΣ</h1>
  <h3>Σελίδα Πωλητή</h3>
</header>

<main style="text-align: center;">
  <div>
    <label>ΠΟΣΟΤΗΤΑ:</label>
    <input type="number" id="quantity" value="1" min="1" style="width: 50px; text-align: center;">
  </div>

  <div id="products-container"></div>
  <h2>Τελευταίες 3 πωλήσεις</h2>
  <div id="last-sales"></div>

</main>

<footer>
  &copy; ΜΕΡΥΒ/ΓΕΠ 2025
</footer>

<script>
async function fetchProducts() {
  const res = await fetch("/api/products");
  const data = await res.json();
  const container = document.getElementById("products-container");
  container.innerHTML = "";

  data.forEach(p => {
    const btn = document.createElement("button");
    btn.innerText = `${p.name} - ${p.price}€`;
    btn.onclick = () => sellProduct(p.id);
    container.appendChild(btn);
  });
}

async function sellProduct(productId) {
  const quantity = document.getElementById("quantity").value;

  const res = await fetch("/api/sell", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productId, quantity })
  });

  const data = await res.json();
  alert(data.message);

  document.getElementById("quantity").value = 1;

  fetchLastSales();
}

async function fetchLastSales() {
  const res = await fetch("/api/last-sales");
  const data = await res.json();
  const div = document.getElementById("last-sales");
  div.innerHTML = "";

  data.forEach((s, idx) => {
    const p = document.createElement("p");
    p.textContent = `Προϊόν: ${s.productName}, Τιμή: ${s.price}€, Ποσότητα: ${s.quantity}`;

    const cancelBtn = document.createElement("button");
    cancelBtn.innerText = "Ακύρωση";
    cancelBtn.style.backgroundColor = 'red';
    cancelBtn.onclick = () => cancelSale(idx);

    const obsInput = document.createElement("input");
    obsInput.placeholder = "ΠΑΡΑΤΗΡΗΣΕΙΣ";

    const obsBtn = document.createElement("button");
    obsBtn.innerText = "✓";
    obsBtn.className = 'obs-btn';
    obsBtn.onclick = () => submitObservation(idx, obsInput.value);

    const obsDiv = document.createElement("div");
    obsDiv.className = "obs-container";
    obsDiv.appendChild(obsInput);
    obsDiv.appendChild(obsBtn);

    const container = document.createElement("div");
    container.className = "obs-btn";
    container.appendChild(p);
    container.appendChild(cancelBtn);
    container.appendChild(obsDiv);

    p.textContent = `Προϊόν: ${s.productName}, Τιμή: ${s.price}€, Ποσότητα: ${s.quantity}`;
    div.appendChild(container);
  });
});

async function cancelSale(index) {
  await fetch("/api/cancel", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ saleIndex: index })
  });
  fetchLastSales();
}

// Ενημέρωση παρατηρήσεων
async function saveObservation(index, observation) {
  await fetch("/api/observation", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ saleIndex: index, observation })
  });
}

fetchProducts();
fetchLastSales();
</script>

<footer>&copy; ΜΕΡΥΒ/ΓΕΠ 2025</footer>
</body>
</html>
