<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Σελίδα Χρήστη</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #90EE90;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    main {
      flex: 1;
      padding: 20px;
      text-align: center;
    }
    footer {
      background-color: #000;
      color: #fff;
      padding: 10px;
      text-align: center;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    button {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
    }
    .cancel-btn { background-color: red; color: white; }
    .obs-btn { background-color: green; color: white; padding: 5px; cursor: pointer; }
    .product-btn { margin: 10px; }
  </style>
</head>
<body>
<header>
  <h1>ΜΕΡΑΡΧΙΑ ΥΠΟΣΤΗΡΙΞΗΣ ΒΑΣΗΣ</h1>
  <h3>Σελίδα Πωλητή</h3>
</header>
<main>
  <input type="number" id="quantity" value="1" min="1" style="font-size:18px; padding:5px; width:80px; text-align:center;">
  <div id="products-container"></div>
  <div id="message" style="color: green;"></div>
  <h2>Τελευταίες 3 πωλήσεις</h2>
  <div id="last-sales"></div>
</main>
<footer>
  &copy; ΜΕΡΥΒ/ΓΕΠ 2025
</footer>
<script>
async function fetchProducts() {
  const res = await fetch("/api/products");
  const data = await res.json();
  const container = document.getElementById("products-container");
  container.innerHTML = "";
  data.forEach(product => {
    const btn = document.createElement("button");
    btn.innerText = `${product.name} (Τιμή: ${product.price}€)`;
    btn.className = "product-btn";
    btn.onclick = () => sellProduct(product.id);
    container.appendChild(btn);
  });
}
async function sellProduct(productId) {
  const quantity = document.getElementById("quantity").value;
  const res = await fetch("/api/sell", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ productId, quantity })
  });
  const data = await res.json();
  if (res.ok) {
    document.getElementById("message").innerText = data.message;
    setTimeout(() => document.getElementById("message").innerText = "", 1000);
    fetchLastSales();
    document.getElementById("quantity").value = 1;
  } else {
    alert(data.message);
  }
}
async function fetchLastSales() {
  const res = await fetch("/api/last-sales");
  const data = await res.json();
  const div = document.getElementById("last-sales");
  div.innerHTML = "";
  data.forEach((sale, index) => {
    const p = document.createElement("p");
    p.textContent = `Προϊόν: ${sale.productName}, Ποσότητα: ${sale.quantity}, Τιμή: ${sale.price}€`;
    const cancelBtn = document.createElement("button");
    cancelBtn.innerText = "Ακύρωση";
    cancelBtn.className = "cancel-btn";
    cancelBtn.onclick = async () => {
      await fetch("/api/cancel", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ saleIndex: index })
      });
      fetchLastSales();
    };
    const obsInput = document.createElement("input");
    obsInput.placeholder = "ΠΑΡΑΤΗΡΗΣΕΙΣ";
    const obsBtn = document.createElement("button");
    obsBtn.className = "obs-btn";
    obsBtn.innerText = "✓";
    obsBtn.onclick = () => {
      fetch("/api/observation", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ saleIndex: index, observation: obsInput.value })
      });
    };
    p.appendChild(cancelBtn);
    p.appendChild(obsInput);
    p.appendChild(obsBtn);
    div.appendChild(p);
  });
}
fetchProducts();
fetchLastSales();
</script>
</body>
</html>
